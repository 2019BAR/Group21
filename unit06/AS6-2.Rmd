---
title: "faith作業  第21組"
output: html_document
---
```{r results='hide', message=FALSE, warning=FALSE, echo=F}
# 這些程式碼設定網頁的格式，並安裝、載入一些基本的套件，請大家不要去改動<br>
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8)
options(scipen=20, digits=5, width=80)
if(!require(pacman)) install.packages("pacman")
library(magrittr)
```



### <span style="font-size:22px">`r "\U1F5FF"` 問題討論：</span>  {data-height=250}
<p class="qiz">
【A.選擇方法】<br>
&emsp;■ 我們為甚麼需要隨機變數？ 什麼時候我們需要用到隨機變數？
Answer:a.隨機變數是一種變數，可以事先列出他所有可能的值，但是實際出現哪個值是由隨機實驗結果隨機決定。<br>
       b.要對不能確定的事情做估計和運算，想定義變數但變數並非固定值。描述指定一個數字給隨機實驗的結果的過程。假若樣本元素本身不是數值時，隨機變數就可以幫忙簡化一些運算的麻煩，簡化樣本空間。<br> 
       
&emsp;■ 隨機變數沒有固定的值，那我們要如何做計算呢？<br>
Answer:因為隨機變數每次實驗結果不一定，因此會選擇取期望值，透過平均數來計算，並且執行多次隨機變數的實驗，也再次取期望值或擷取片段來推導母體。<br>

&emsp;■ 我們可以用直方圖或數值標記來估計噴發時間落在某一區間的機率嗎？<br>
Answer:理論上兩者都可以，直方圖可以計算出某區間機率，而數值標記我認為在某些大樣本情況下會較難判斷。

&emsp;■ 直方圖(histogram)也可以當作一種模型嗎？ 數值標記(rug)呢？<br>
Answer:a.模型定義是能夠將現實的現象簡化，讓我們更好估計、運算、溝通，而直方圖簡化了數據，方便溝通、呈現，因此我認為直方圖可以當作模型。<br>
       b.我認為不行，因為他只能呈現出發生事件在整個X軸密集程度，但是他無法得知特定x軸的次數、機率密度，因此我認為他不夠完整成為模型(欄寬最小的直方)。<br>

&emsp;■ 直方圖和平滑模型哪一個比較適合用來表示噴發時間的分布？ 為甚麼？<br>
Answer:直方圖容易有量化誤差，我認為平滑模型較能呈現噴發時間分布(連續變數分布)。<br>

&emsp;■ 用數值標記來預測噴發時間會比用直方圖「準」嗎？ 「準」是什麼意思呢？<br>
Answer:a.不會，因為數值標記所給的資訊量過於簡略，因此我認為直方圖比較能夠準確預測。
       b.準的定義是預測的精準度，也可以是對某變數的解釋度。<br>
<br>
【B.調整參數】調整一下模型參數的滑桿 ...<br>
&emsp;■ 你覺得最合適的直方圖欄數(`support/binwidth`)是？ 為甚麼？<br>
Answer:因為我認為他的直方圖間的差距比較小，然後也不會太過於複雜導致不夠一般性。(不會太過像現有資料)<br>

&emsp;■ 最合適的平滑模型頻寬(`bandwidth`)呢？<br>
Answer:我認為最棒的是0.6，因為他不會太過複雜。<br>

&emsp;■ 調高欄寬和頻寬會讓模型變複雜，還是變簡單呢？<br>
Answer:欄寬越寬會讓直方圖變得很簡略，而頻寬越高也會讓模型變簡單。<br>

&emsp;■ 模型越複雜，它跟實際值之間的誤差是越大、還是越小？<br>
Answer:模型越複雜，他會讓他與訓練集的值越像，但是他與一般性的誤差會越大，因為他有點偏頗了，適當之下是會精準的。<br>
&emsp;■ 那麼，越複雜的模型就會越準，對嗎？<br>
Answer:當然不對。<br>
<br>
【C.建立模型、估計機率】<br>
請從課堂筆記的程式碼找出來 ... <br>
&emsp;■ 從變數向量(`D`)求出機率密度曲線(`DEN`)<br>
&emsp;■ 將機率密度曲線(`DEN`)轉換成機率密度函數(`PDF`)<br>
&emsp;■ 對機率密度函數(`PDF`)做積分，算出機率(`PROB`)<br>
```{r}
#查看faithful的前面6row 並且觀察D的敘述統計量
head(faithful)    
#將eruptions 改成 waiting
D = (faithful$waiting)/10 
#查看D的敘述統計量
summary(D) 
hist(D)

# Frame
par(cex=0.7)#控制字體大小
plot(0,0,xlim=c(4.2,9.7),ylim=c(0,1.1),xlab="等待時間(分鐘)", 
     ylab="密度 or (累計)機率", main="分布、機率與密度")
abline(h=1, col='lightgray', lwd=0.25, lty=2)

# Empirical PDF   #這一條一條的線表示waiting的數據在那些時間中發生
rug(D) 

# Empirical CDF)  # add=T的用意是不希望第一張圖直接換第二章，而是加上去
plot(ecdf(D), cex=0, verticals=T, lwd=2, col='darkgray', add=T)

# Histogram PDF  (直方圖算是RUG的超級簡化)
Bins=20       #指定欄位數                      # no. bins
bx = seq(min(D), max(D), length=Bins+1) # break sequence bin+1因為bin只欄寬會少一根件頭 
hist(D, col="#B3FFFF7F", border="white", ylim=c(0,1.1),
     freq=F, breaks=bx, add=T)#我們想要density不要feq
abline(h=0, col='lightgray', lwd=0.25)

# Histogram CDF
adj = (bx[2] - bx[1])/2
steps = stepfun(bx-adj, c(0, sapply(bx, function(b) mean(D <= b))))
plot(steps, cex=0, col='#33CC337F', lwd=3, lty=1, add=T)

# Smooth PDF  (PDF通常使用這個做為圖表)
Adjust =1    # bandwidth adjustment
DEN = density(D, adjust = Adjust)          #連續變數:頻寬越小圖形越複雜(bandwidth)
                                           #而類別變數如Hist()則是欄寬越大越複雜(binwidth) 欄數=support/binwidth
lines(DEN, col='gold', lwd=3)

# Smooth CDF
PDF = approxfun(DEN$x, DEN$y, yleft=0, yright=0)
x = seq(4.2,9.7,1)
y = sapply(x, function(i) integrate(PDF, -Inf, i)$value)
lines(x, y, col='red', lwd=3, lty=2) 

# Mark Range
x1 = 8.0; x2 = 9.0
rect(x1,-0.1,x2,1.2,col= rgb(0,1,0,alpha=0.2),border=NA)
# x = seq(x1, x2, length=100)
# polygon(c(x, x2, x1),  c(PDF(x), 0, 0), col="#FF99003F", border=NA)
# Calculate Probability
(integrate(PDF, x1, x2)$value)

```


這三行程式，然後...<br>
&emsp;■ 將頻寬調整參數(`adjust`)設為`1`，算出「等待時間」落在80到90之間的機率<br>
```{r}
#0.26851
```

&emsp;■ 將頻寬調整參數設為`0.5`，算出等待時間落在80到90之間的機率<br>
```{r}
#0.28275
```

&emsp;■ 算出來的機率比較高的就是比較好的模型，對嗎？
為甚麼？<br>
Answer: 不一定，頻寬越小模型就會越複雜，但是若太高的話反而對於預測來說是不好的預測模型。<br>

<br>
【D.預測與決策】<br>
假設有一個賭局，你可以花30元選定一個連續60秒的時段，如果老忠實下一次的噴發時間落在你指定的區間，你就可以贏到100元；請你使用頻寬為`0.5`的平滑密度模型 ...<br>
&emsp;■ 決定要不要參加這個賭局<br>
```{r}
#期望值=31.958，參加
```

&emsp;■ 如果你參加的話，你要把噴發時間設定在哪一個區間呢？<br>
```{r}
head(faithful)    

#將eruptions 改成 waiting
A = faithful$eruptions

#查看D的敘述統計量
summary(A) 
hist(A)

# Frame
par(cex=0.7)#控制字體大小
plot(0,0,xlim=c(42,97),ylim=c(0,1.1),xlab="等待時間(分鐘)", 
     ylab="密度 or (累計)機率", main="分布、機率與密度")
abline(h=1, col='lightgray', lwd=0.25, lty=2)

# Empirical PDF   #這一條一條的線表示waiting的數據在那些時間中發生  
rug(A)   #數值標記

# Empirical CDF)  # add=T的用意是不希望第一張圖直接換第二章，而是加上去
plot(ecdf(A), cex=0, verticals=T, lwd=2, col='darkgray', add=T)

# Histogram PDF  (直方圖算是RUG的超級簡化)
Bins=20       #指定欄位數                      # no. bins
bx = seq(min(A), max(A), length=Bins+1) # break sequence bin+1因為bin只欄寬會少一根件頭 
hist(A, col="#B3FFFF7F", border="white", ylim=c(0,1.1),
     freq=F, breaks=bx, add=T)#我們想要density不要feq
abline(h=0, col='lightgray', lwd=0.25)

# Histogram CDF
adj = (bx[2] - bx[1])/2
steps = stepfun(bx-adj, c(0, sapply(bx, function(b) mean(D <= b))))
plot(steps, cex=0, col='#33CC337F', lwd=3, lty=1, add=T)

# Smooth PDF  (PDF通常使用這個做為圖表)
Adjust =0.5    # bandwidth adjustment
DEN = density(A, adjust = Adjust)          #連續變數:頻寬越小圖形越複雜(bandwidth)
                                           #而類別變數如Hist()則是欄寬越大越複雜(binwidth) 欄數=support/binwidth
lines(DEN, col='gold', lwd=3)

# Smooth CDF
PDF = approxfun(DEN$x, DEN$y, yleft=0, yright=0)
x = seq(1,6,1)
y = sapply(x, function(i) integrate(PDF, -Inf, i)$value)
lines(x, y, col='red', lwd=3, lty=2) 

# Mark Range
x1 = 1; x2 = 2
rect(x1,-0.1,x2,1.2,col= rgb(0,1,0,alpha=0.2),border=NA)
# x = seq(x1, x2, length=100)
# polygon(c(x, x2, x1),  c(PDF(x), 0, 0), col="#FF99003F", border=NA)
# Calculate Probability
(integrate(PDF, x1, x2)$value)

i1=seq(1,5,by=0.1)
i2=seq(2,6,by=0.1)
p=data.frame(i1,i2)
for(i in 1:41){
  p[i,3]=integrate(PDF,i1[i],i2[i])$value
}
p

```


```{r}
p[which(p$V3==max(p$V3)),]
#3.9~4.9
```

&emsp;■ 你設在這個區間的話，參加這個賭局的期望值是？<br>
```{r}
-(30*(1-max(p$V3)))+70*max(p$V3)
#17.66
```

<br>
假如賭場老闆從零開始把每10秒鐘設為一個區間，每個區間的賭金是五塊錢 ...<br>
&emsp;■ 你要怎麼押注，才能獲得最高的期望值呢？<br>

```{r}
i1=seq(1,6-1/6,by=0.1)
i2=seq(1+1/6,6,by=0.1)
p=data.frame(i1,i2)
for(i in 1:49){
  p[i,3]=integrate(PDF,i1[i],i2[i])$value
}
head(p[order(p$V3,decreasing =T ),],6)
```

&emsp;■ 你的賭金和期望值各是多少？<br>
```{r}
W=faithful$eruptions
Adjust=0.5
Den=density(W,adjust=Adjust)
PDF=approxfun(DEN$x,DEN$y,yleft=0,yright=0)
seq_time=seq(0,6,1/6)
ans=sapply(seq_time,function(x){
  pro=integrate(PDF,x,(x+1/6))$value
  -5*(1-pro)+95*(pro)
})

seq_time
ans
sum(tail(sort(ans),6))
tail(sort(ans),6)


```

<br>
將獲利的期望值和賭金的比值稱為「期望投資報酬率」 ...<br>

&emsp;■ 「最大期望投資報酬率」)和「最大期望報酬」的投資策略是一樣的嗎？<br>
Answer: 最大期望投資報酬率為投入期間總利潤/投入成本，最大期望報酬就是投入期間總利潤。

&emsp;■ 你認為哪一個策略目標比較好呢？ 為什麼？<br>
Answer:最大期望投資報酬率比較好，因為有考慮成本，而最大期望報酬不考慮成本。
<br>
</p class="qiz">




